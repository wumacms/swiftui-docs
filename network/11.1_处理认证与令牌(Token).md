# 处理认证与令牌 (Token)

在网络请求中，处理认证与令牌至关重要。令牌就像一把钥匙🔑，允许你的应用安全地访问受保护的资源。没有它，就像没有钥匙就想打开门一样，访问会被拒绝。

## 令牌认证流程

令牌认证通常涉及以下步骤：

1.  **用户登录**: 用户提供用户名和密码。
2.  **服务器验证**: 服务器验证用户凭据。
3.  **颁发令牌**: 如果验证成功，服务器会颁发一个令牌（例如，JWT）。
4.  **存储令牌**: 客户端（你的应用）安全地存储令牌。
5.  **请求时携带令牌**: 客户端在后续请求的头部中携带令牌（通常在 `Authorization` 头部）。
6.  **服务器验证令牌**: 服务器验证令牌的有效性。
7.  **授权访问**: 如果令牌有效，服务器授权访问请求的资源。

## 如何安全地存储令牌

安全存储令牌至关重要，防止未经授权的访问。以下是一些建议：

*   **Keychain**: 使用 Keychain 来存储敏感信息，例如令牌。Keychain 提供了一个安全的存储区域，可以防止未经授权的访问。
*   **避免明文存储**: 永远不要将令牌以明文形式存储在本地存储或用户默认设置中。
*   **加密**: 如果必须将令牌存储在本地，请使用强加密算法对其进行加密。

## 在请求中添加令牌

在每个需要认证的请求中，你需要将令牌添加到请求头部。通常，这通过 `Authorization` 头部完成。

```swift
let token = "你的令牌"
let headers = ["Authorization": "Bearer \(token)"]
```

*   **Bearer 方案**: 使用 "Bearer" 方案是一种常见的做法，它告诉服务器这是一个 Bearer 令牌。
*   **拦截器**: 你可以使用拦截器来自动将令牌添加到每个请求中，避免手动添加的麻烦。

## 错误处理与令牌失效

当令牌失效时，服务器会返回一个错误。你需要处理这些错误，并采取适当的措施，例如：

1.  **检测错误**: 检查服务器返回的错误代码（例如，401 Unauthorized）。
2.  **刷新令牌**: 如果你实现了刷新令牌机制，尝试刷新令牌。
3.  **重新登录**: 如果刷新令牌失败，提示用户重新登录。

处理认证和令牌是构建安全可靠的SwiftUI应用的关键步骤。确保你理解这些概念，并采取适当的安全措施来保护用户数据。💪